<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="code_files/libs/clipboard/clipboard.min.js"></script>
<script src="code_files/libs/quarto-html/quarto.js"></script>
<script src="code_files/libs/quarto-html/popper.min.js"></script>
<script src="code_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="code_files/libs/quarto-html/anchor.min.js"></script>
<link href="code_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="code_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="code_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="code_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="code_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"./strokeStudy.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ readr     2.1.5
✔ lubridate 1.9.4     ✔ tibble    3.3.0
✔ purrr     1.1.0     ✔ tidyr     1.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ nlme::collapse() masks dplyr::collapse()
✖ dplyr::filter()  masks stats::filter()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'janitor'

The following objects are masked from 'package:stats':

    chisq.test, fisher.test</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mice'

The following object is masked from 'package:stats':

    filter

The following objects are masked from 'package:base':

    cbind, rbind</code></pre>
</div>
</div>
<section id="eda" class="level1">
<h1>EDA</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>time_stage_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"baseline"</span>, <span class="st">"mid"</span>, <span class="st">"final"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">emsvscar =</span> em_svs_car) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">race2 =</span> <span class="fu">na_if</span>(race2, <span class="st">"Missing"</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">race2 =</span> <span class="fu">factor</span>(race2),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_id =</span> <span class="fu">factor</span>(site_id),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">home_num =</span> <span class="fu">as.integer</span>(home_or_rehab),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">notify_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      pre_hosp_notify <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      pre_hosp_notify <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">transport_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      emsvscar <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      emsvscar <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_num =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"Female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_stage =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      time2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y1Q1"</span>, <span class="st">"Y1Q2"</span>) <span class="sc">~</span> <span class="st">"baseline"</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>      time2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y1Q3"</span>, <span class="st">"Y1Q4"</span>, <span class="st">"Y2Q1"</span>, <span class="st">"Y2Q2"</span>) <span class="sc">~</span> <span class="st">"mid"</span>,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>      time2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y2Q3"</span>, <span class="st">"Y2Q4"</span>) <span class="sc">~</span> <span class="st">"final"</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_stage =</span> <span class="fu">factor</span>(time_stage, <span class="at">levels =</span> time_stage_levels)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1752 obs. of  17 variables:
 $ site_id         : Factor w/ 9 levels "100","110","120",..: 2 1 1 1 1 1 2 2 2 1 ...
 $ time2           : Factor w/ 8 levels "Y1Q1","Y1Q2",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ age             : int  79 70 91 45 43 47 57 52 80 34 ...
 $ gender          : Factor w/ 2 levels "Male","Female": 2 1 1 2 2 2 1 1 1 1 ...
 $ race2           : Factor w/ 3 levels "Caucasian","African American",..: 1 2 1 2 3 1 1 1 3 2 ...
 $ emsvscar        : num  1 1 1 0 0 1 0 0 1 1 ...
 $ pre_hosp_notify : Factor w/ 2 levels "Yes","No": 1 1 1 2 2 1 2 2 1 1 ...
 $ had_thrombectomy: logi  TRUE FALSE FALSE FALSE TRUE TRUE ...
 $ had_tpa         : logi  FALSE TRUE TRUE TRUE FALSE FALSE ...
 $ tpa_complic     : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ thr_complic     : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ home_or_rehab   : logi  TRUE TRUE TRUE TRUE FALSE TRUE ...
 $ home_num        : int  1 1 1 1 0 1 1 1 1 1 ...
 $ notify_num      : num  1 1 1 0 0 1 0 0 1 1 ...
 $ transport_num   : num  1 1 1 0 0 1 0 0 1 1 ...
 $ gender_num      : num  1 0 0 1 1 1 0 0 0 0 ...
 $ time_stage      : Factor w/ 3 levels "baseline","mid",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<p>missingness per variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>na_table <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"n_missing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_missing))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>missingness aggregated by site</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_id) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>site_id, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"prop_missing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> site_id, <span class="at">fill =</span> prop_missing)) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Missingness by Site"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> home_or_rehab, <span class="at">y =</span> age, <span class="at">fill =</span> home_or_rehab)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Age Differences by Outcome"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 802 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">fill =</span> home_or_rehab)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion"</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Outcome by Gender"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> race2, <span class="at">fill =</span> home_or_rehab)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion"</span>, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Outcome by Race"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ems_label =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    emsvscar <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"EMS Arrival"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    emsvscar <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Car Arrival"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Missing"</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ems_label, <span class="at">fill =</span> home_or_rehab)) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Outcome by Arrival Method"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Arrival Method"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Good Outcome"</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"tomato"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>missingness by quarter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time2) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>time2, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"prop_missing"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(variable, time2, <span class="at">fill =</span> prop_missing)) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Missingness by Quarter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>missingness correlation plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>missingness by time stage</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_stage) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(.))), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>time_stage,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"prop_missing"</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> time_stage, <span class="at">fill =</span> prop_missing)) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">name  =</span> <span class="st">"Proportion</span><span class="sc">\n</span><span class="st">Missing"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Missingness by Time Stage (Baseline / Mid / Final)"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Variable"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time Stage"</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>age missingness by site x quarter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_missing =</span> <span class="fu">is.na</span>(age)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site_id, time2) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_age_missing =</span> <span class="fu">mean</span>(age_missing), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time2, <span class="at">y =</span> site_id, <span class="at">fill =</span> prop_age_missing)) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Share of Records Missing Age by Site and Quarter"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Percent</span><span class="sc">\n</span><span class="st">Missing"</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Can clearly see that this is not MCAR; its MAR.</p>
</section>
<section id="missing-data-frequentist-model" class="level1">
<h1>Missing data + Frequentist model</h1>
<p>use predictive mean matching by drawing 20 multiply imputed data sets</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>impute_vars <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    home_or_rehab, age, gender, race2, emsvscar, pre_hosp_notify,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    had_tpa, had_thrombectomy, tpa_complic, thr_complic,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    site_id, time2</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>meth <span class="ot">&lt;-</span> <span class="fu">make.method</span>(impute_vars)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>meth[<span class="st">"age"</span>] <span class="ot">&lt;-</span> <span class="st">"pmm"</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">make.predictorMatrix</span>(impute_vars)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>pred[<span class="st">"age"</span>, ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>pred[<span class="st">"age"</span>, <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"race2"</span>, <span class="st">"emsvscar"</span>, <span class="st">"pre_hosp_notify"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"had_tpa"</span>, <span class="st">"had_thrombectomy"</span>, <span class="st">"tpa_complic"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"thr_complic"</span>, <span class="st">"site_id"</span>, <span class="st">"time2"</span>, <span class="st">"home_or_rehab"</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">&lt;-</span> <span class="fu">mice</span>(</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  impute_vars,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="dv">20</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxit =</span> <span class="dv">20</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> meth,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictorMatrix =</span> pred,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">2025</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">printFlag =</span> <span class="cn">FALSE</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of logged events: 400</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Class: mids
Number of multiple imputations:  20 
Imputation methods:
   home_or_rehab              age           gender            race2 
        "logreg"            "pmm"               ""        "polyreg" 
        emsvscar  pre_hosp_notify          had_tpa had_thrombectomy 
           "pmm"         "logreg"               ""               "" 
     tpa_complic      thr_complic          site_id            time2 
              ""               ""               ""               "" 
PredictorMatrix:
                home_or_rehab age gender race2 emsvscar pre_hosp_notify had_tpa
home_or_rehab               0   1      1     1        1               1       1
age                         1   0      1     1        1               1       1
gender                      1   1      0     1        1               1       1
race2                       1   1      1     0        1               1       1
emsvscar                    1   1      1     1        0               1       1
pre_hosp_notify             1   1      1     1        1               0       1
                had_thrombectomy tpa_complic thr_complic site_id time2
home_or_rehab                  1           1           1       1     1
age                            1           1           1       1     1
gender                         1           1           1       1     1
race2                          1           1           1       1     1
emsvscar                       1           1           1       1     1
pre_hosp_notify                1           1           1       1     1
Number of logged events:  400 
  it im dep meth                    out
1  1  1 age  pmm site_id140, site_id170
2  1  2 age  pmm site_id140, site_id170
3  1  3 age  pmm site_id140, site_id170
4  1  4 age  pmm site_id140, site_id170
5  1  5 age  pmm site_id140, site_id170
6  1  6 age  pmm site_id140, site_id170</code></pre>
</div>
</div>
<p>constructs 20 predictive-mean-matching imputations for Age using the specified covariates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit1_mi <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  imp,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    home_or_rehab <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race2 <span class="sc">+</span> emsvscar <span class="sc">+</span> pre_hosp_notify <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      had_tpa <span class="sc">+</span> had_thrombectomy <span class="sc">+</span> tpa_complic <span class="sc">+</span> thr_complic <span class="sc">+</span> time2,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> binomial</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pool</span>(fit1_mi) <span class="sc">%&gt;%</span> <span class="fu">summary</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    term    estimate   std.error    statistic        df
1            (Intercept) 665.6021918 0.828972065  7.841871222  55.38090
2                    age   0.9397909 0.009416161 -6.594822268  33.64384
3           genderFemale   0.6596744 0.137053246 -3.035381699 278.92232
4  race2African American   0.5743311 0.166812718 -3.324381684 163.24787
5             race2Other   0.5963471 0.292048563 -1.770021875 385.86304
6               emsvscar   0.3590347 0.335293357 -3.055045204 426.01912
7      pre_hosp_notifyNo   0.9982560 0.223991143 -0.007792792 155.47690
8            had_tpaTRUE   1.6894133 0.181094345  2.895624952 427.31481
9   had_thrombectomyTRUE   0.5336110 0.179046244 -3.507966048 299.39652
10       tpa_complicTRUE   0.2577050 0.465811857 -2.910917627  88.56888
11       thr_complicTRUE   0.2511692 0.405044176 -3.411055878 828.20902
12             time2Y1Q2   1.0872388 0.291869328  0.286570992 272.66031
13             time2Y1Q3   1.2633451 0.291751829  0.801239312 547.29906
14             time2Y1Q4   1.1426728 0.289859436  0.460119952 378.26761
15             time2Y2Q1   1.1887924 0.289588505  0.597185303 403.81189
16             time2Y2Q2   1.5762660 0.315935102  1.440355089 255.47028
17             time2Y2Q3   1.4900642 0.293494284  1.358865278 521.62303
18             time2Y2Q4   1.3427948 0.294244330  1.001729204 461.49949
        p.value       2.5 %       97.5 %    conf.low    conf.high
1  1.511333e-10 126.4253263 3504.2525955 126.4253263 3504.2525955
2  1.545034e-07   0.9219712    0.9579550   0.9219712    0.9579550
3  2.629180e-03   0.5036876    0.8639686   0.5036876    0.8639686
4  1.094195e-03   0.4131527    0.7983882   0.4131527    0.7983882
5  7.751313e-02   0.3358341    1.0589453   0.3358341    1.0589453
6  2.391604e-03   0.1857467    0.6939876   0.1857467    0.6939876
7  9.937923e-01   0.6413345    1.5538147   0.6413345    1.5538147
8  3.978177e-03   1.1834510    2.4116903   1.1834510    2.4116903
9  5.208227e-04   0.3751472    0.7590105   0.3751472    0.7590105
10 4.557820e-03   0.1021247    0.6503012   0.1021247    0.6503012
11 6.784539e-04   0.1134195    0.5562183   0.1134195    0.5562183
12 7.746585e-01   0.6120370    1.9314001   0.6120370    1.9314001
13 4.233408e-01   0.7122492    2.2408460   0.7122492    2.2408460
14 6.456945e-01   0.6462509    2.0204247   0.6462509    2.0204247
15 5.507184e-01   0.6727703    2.1006090   0.6727703    2.1006090
16 1.509913e-01   0.8461064    2.9365271   0.8461064    2.9365271
17 1.747766e-01   0.8371459    2.6522153   0.8371459    2.6522153
18 3.169993e-01   0.7531645    2.3940293   0.7531645    2.3940293</code></pre>
</div>
</div>
<p>fits the logistic model within each imputed dataset and pools odds ratios that respect imputation uncertainty. # Frequentist model diagnostics</p>
<ol type="1">
<li>first imputed dataset</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>comp1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp, <span class="dv">1</span>)  <span class="co"># first imputed dataset</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>fit_fixed <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  home_or_rehab <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race2 <span class="sc">+</span> emsvscar <span class="sc">+</span> pre_hosp_notify <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    had_tpa <span class="sc">+</span> had_thrombectomy <span class="sc">+</span> tpa_complic <span class="sc">+</span> thr_complic <span class="sc">+</span> time2,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> comp1,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>comp1<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_fixed, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lme4'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:nlme':

    lmList</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fit_mixed <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  home_or_rehab <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race2 <span class="sc">+</span> emsvscar <span class="sc">+</span> pre_hosp_notify <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    had_tpa <span class="sc">+</span> had_thrombectomy <span class="sc">+</span> tpa_complic <span class="sc">+</span> thr_complic <span class="sc">+</span> time2 <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> site_id),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data   =</span> comp1,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :
Model failed to converge with max|grad| = 0.00789023 (tol = 0.002, component 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, : Model is nearly unidentifiable: very large eigenvalue
 - Rescale variables?</code></pre>
</div>
</div>
<p>random effect for site id is extremely small (variance close to 0)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>pearson_res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit_fixed, <span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Overdispersion ratio</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>overdisp_fixed <span class="ot">&lt;-</span> <span class="fu">sum</span>(pearson_res<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">df.residual</span>(fit_fixed)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>overdisp_fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9939514</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pearson_res_mixed <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit_mixed, <span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>overdisp_mixed <span class="ot">&lt;-</span> <span class="fu">sum</span>(pearson_res_mixed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">df.residual</span>(fit_mixed)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>overdisp_mixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9831857</code></pre>
</div>
</div>
<p>≈ 1 → no overdispersion in both fixed &amp; mixed model -&gt; adding site effect doesnt reduce dispersion</p>
<ol start="2" type="1">
<li>all imputed datasets</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cal_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>imp<span class="sc">$</span>m, <span class="cf">function</span>(k) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  dat_k <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp, k)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  fit_k <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    home_or_rehab <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race2 <span class="sc">+</span> emsvscar <span class="sc">+</span> pre_hosp_notify <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      had_tpa <span class="sc">+</span> had_thrombectomy <span class="sc">+</span> tpa_complic <span class="sc">+</span> thr_complic <span class="sc">+</span> time2,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_k,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> binomial</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  dat_k<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_k, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  dat_k <span class="sc">%&gt;%</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">bin =</span> <span class="fu">ntile</span>(pred, <span class="dv">10</span>),</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">imp =</span> k</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(imp, bin) <span class="sc">%&gt;%</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_pred =</span> <span class="fu">mean</span>(pred),</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">obs_rate  =</span> <span class="fu">mean</span>(home_or_rehab),</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups   =</span> <span class="st">"drop"</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>cal_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cal_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calibration-plot" class="level1">
<h1>calibration plot</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
arm (Version 1.14-4, built: 2024-4-1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Working directory is /Users/anirudhjain/Documents/College/Semester 7/STA440L/Case Studies/Sta440_case5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cal <span class="ot">&lt;-</span> comp1 <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bin =</span> <span class="fu">ntile</span>(pred, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bin) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pred =</span> <span class="fu">mean</span>(pred),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs_rate =</span> <span class="fu">mean</span>(home_or_rehab)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cal, <span class="fu">aes</span>(mean_pred, obs_rate)) <span class="sc">+</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>, <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Calibration Plot"</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Mean Predicted Probability"</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Observed Proportion"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cal_all, <span class="fu">aes</span>(<span class="at">x =</span> mean_pred, <span class="at">y =</span> obs_rate)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> imp) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Calibration Plots Across Imputations"</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mean Predicted Probability"</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Observed Proportion"</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="roc-curve" class="level1">
<h1>ROC curve</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(comp1<span class="sc">$</span>home_or_rehab, comp1<span class="sc">$</span>pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span> <span class="sc">-</span> roc_obj<span class="sc">$</span>specificities,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>     roc_obj<span class="sc">$</span>sensitivities,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"1 – Specificity (False Positive Rate)"</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"ROC Curve"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fl">0.6</span>, <span class="at">y =</span> <span class="fl">0.1</span>,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)),</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">1.3</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>roc_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(k) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  dat_k <span class="ot">&lt;-</span> <span class="fu">complete</span>(imp, k)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  fit_k <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    home_or_rehab <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> race2 <span class="sc">+</span> emsvscar <span class="sc">+</span> pre_hosp_notify <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>      had_tpa <span class="sc">+</span> had_thrombectomy <span class="sc">+</span> tpa_complic <span class="sc">+</span> thr_complic <span class="sc">+</span> time2,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_k,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> binomial</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  pred_k <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_k, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc</span>(dat_k<span class="sc">$</span>home_or_rehab, pred_k)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn ROC curves into a data frame</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>roc_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(roc_list), <span class="cf">function</span>(k) {</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">imp =</span> k,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fpr =</span> <span class="dv">1</span> <span class="sc">-</span> roc_list[[k]]<span class="sc">$</span>specificities,  <span class="co"># 1 - specificity</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpr =</span> roc_list[[k]]<span class="sc">$</span>sensitivities       <span class="co"># sensitivity</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC per imputation (for optional labels)</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>auc_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(roc_list, auc)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>auc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">imp =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">auc =</span> auc_values</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Faceted ROC plots</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_df, <span class="fu">aes</span>(<span class="at">x =</span> fpr, <span class="at">y =</span> tpr)) <span class="sc">+</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> imp) <span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ROC Curves Across Imputations"</span>,</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"1 – Specificity (False Positive Rate)"</span>,</span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sensitivity"</span></span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Optional: add AUC text inside each facet</span></span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> auc_df,</span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.7</span>, <span class="at">y =</span> <span class="fl">0.1</span>,</span>
<span id="cb107-31"><a href="#cb107-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"AUC = "</span>, <span class="fu">round</span>(auc, <span class="dv">3</span>))),</span>
<span id="cb107-32"><a href="#cb107-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb107-33"><a href="#cb107-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span></span>
<span id="cb107-34"><a href="#cb107-34" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="which-variables-were-predictive-of-missingness" class="level1">
<h1>which variables were predictive of missingness</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>miss_age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x<span class="sc">$</span>age), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>find_predictors_of_missingness <span class="ot">&lt;-</span> <span class="cf">function</span>(var) {</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Create missingness indicator</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  miss_indicator <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">is.na</span>(x[[var]]))</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Build dataset with predictors (drop the variable being tested)</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  predictors <span class="ot">&lt;-</span> x[, <span class="fu">setdiff</span>(<span class="fu">names</span>(x), var), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Combine into one dataframe</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  data_miss <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">miss =</span> miss_indicator, predictors)</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Fit logistic regression</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(miss <span class="sc">~</span> ., <span class="at">data =</span> data_miss, <span class="at">family =</span> binomial)</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">summary</span>(fit))</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a><span class="fu">find_predictors_of_missingness</span>(<span class="st">"age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = miss ~ ., family = binomial, data = data_miss)

Coefficients: (7 not defined because of singularities)
                        Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)           -2.657e+01  7.014e+04   0.000    1.000
site_id110            -1.701e-10  4.253e+04   0.000    1.000
site_id120             1.176e-09  5.123e+04   0.000    1.000
site_id130             5.301e-10  4.171e+04   0.000    1.000
site_id140            -4.783e-06  6.439e+04   0.000    1.000
site_id150            -1.573e-07  6.455e+04   0.000    1.000
site_id160            -5.940e-10  3.887e+04   0.000    1.000
site_id170            -1.829e-07  5.913e+04   0.000    1.000
site_id180             1.578e-09  4.321e+04   0.000    1.000
time2Y1Q2             -3.422e-10  4.507e+04   0.000    1.000
time2Y1Q3              7.611e-11  4.688e+04   0.000    1.000
time2Y1Q4              2.566e-09  4.585e+04   0.000    1.000
time2Y2Q1              3.653e-11  4.586e+04   0.000    1.000
time2Y2Q2              9.301e-11  4.640e+04   0.000    1.000
time2Y2Q3              3.515e-10  4.564e+04   0.000    1.000
time2Y2Q4              7.032e-11  4.689e+04   0.000    1.000
genderFemale          -6.708e-11  1.942e+04   0.000    1.000
race2African American -9.161e-10  2.329e+04   0.000    1.000
race2Other            -6.597e-10  4.024e+04   0.000    1.000
emsvscar               9.997e-10  3.972e+04   0.000    1.000
pre_hosp_notifyNo      5.551e-10  3.162e+04   0.000    1.000
had_thrombectomyTRUE  -9.252e-10  2.510e+04   0.000    1.000
had_tpaTRUE           -1.755e-10  2.863e+04   0.000    1.000
tpa_complicTRUE        1.281e-08  7.500e+04   0.000    1.000
thr_complicTRUE        5.298e-10  7.438e+04   0.000    1.000
home_or_rehabTRUE     -2.500e-10  2.279e+04   0.000    1.000
home_num                      NA         NA      NA       NA
notify_num                    NA         NA      NA       NA
transport_num                 NA         NA      NA       NA
gender_num                    NA         NA      NA       NA
time_stagemid                 NA         NA      NA       NA
time_stagefinal               NA         NA      NA       NA
ems_labelEMS Arrival          NA         NA      NA       NA
miss_age               5.313e+01  4.784e+04   0.001    0.999

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1.9065e+03  on 1396  degrees of freedom
Residual deviance: 8.1048e-09  on 1370  degrees of freedom
  (355 observations deleted due to missingness)
AIC: 54

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
<p>indicates perfect separation (complete separation) missingness mechanism is</p>
<p>Not random. but structural, driven by site and quarter</p>
</section>
<section id="bayesian-model" class="level1">
<h1>Bayesian model</h1>
<p>Reference patient</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>age_ref    <span class="ot">&lt;-</span> <span class="fu">median</span>(x<span class="sc">$</span>age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>gender_ref <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(x<span class="sc">$</span>gender_num), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span>])</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>ems_ref    <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(x<span class="sc">$</span>transport_num), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span>])</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>age_ref</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 70</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>gender_ref</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>ems_ref</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>age = 70 gender = 0 (female) race = Caucasian EMS = 0, notify = 0 TPA = 0, thrombectomy = 0, no complications site effect = average = 0</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="st">  # 0. OUTCOME MODEL: home_or_rehab</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="st">    # Binary outcome</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="st">    home[i] ~ dbern(p[i])</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="st">    # Logistic mixed model</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="st">    logit(p[i]) &lt;-</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="st">        beta0 +</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_age   * age[i] +</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_gender * gender[i] +          # 0/1</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_ems   * transport[i] +        # EMS vs car</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_not   * notify[i] +           # pre-hosp notification</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_tpa   * had_tpa[i] +</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_thr   * had_thromb[i] +</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_tpaC  * tpa_comp[i] +</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_thrC  * thr_comp[i] +</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_time[ time_stage[i] ] +</span></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="st">        beta_race[race[i]] +               # race coded 1..nRace</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="st">        u_site_out[ site[i] ]              # site random effect</span></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="st">  # Priors for outcome fixed effects</span></span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="st">  beta0       ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_age    ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_gender ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_ems    ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_not    ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_tpa    ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_thr    ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_tpaC   ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_thrC   ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a><span class="st">  # Time (quarter) effects</span></span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_time[1] &lt;- 0                     # baseline = reference level</span></span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a><span class="st">for (t in 2:nTimeStage) {             # mid, final</span></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_time[t] ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a><span class="st">  # Race effects, first category as reference (Caucasian)</span></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a><span class="st">  for (r in 2:nRace) {</span></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a><span class="st">    beta_race[r] ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_race[1] &lt;- 0</span></span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a><span class="st">  # Site random intercepts for outcome</span></span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a><span class="st">  for (s in 1:nSite) {</span></span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a><span class="st">    u_site_out[s] ~ dnorm(0, tau_site_out)</span></span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a><span class="st">  tau_site_out &lt;- pow(sigma_site_out, -2)</span></span>
<span id="cb117-57"><a href="#cb117-57" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_site_out ~ dunif(0, 2)</span></span>
<span id="cb117-58"><a href="#cb117-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-59"><a href="#cb117-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-60"><a href="#cb117-60" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-61"><a href="#cb117-61" aria-hidden="true" tabindex="-1"></a><span class="st">  # 1. AGE MODEL: age | transport, notify, site, time, gender</span></span>
<span id="cb117-62"><a href="#cb117-62" aria-hidden="true" tabindex="-1"></a><span class="st">  #    (p(age | transport, notify, z))</span></span>
<span id="cb117-63"><a href="#cb117-63" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-64"><a href="#cb117-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-65"><a href="#cb117-65" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb117-66"><a href="#cb117-66" aria-hidden="true" tabindex="-1"></a><span class="st">    age[i] ~ dnorm(mu_age[i], tau_age)</span></span>
<span id="cb117-67"><a href="#cb117-67" aria-hidden="true" tabindex="-1"></a><span class="st">    mu_age[i] &lt;-</span></span>
<span id="cb117-68"><a href="#cb117-68" aria-hidden="true" tabindex="-1"></a><span class="st">        alpha0 +</span></span>
<span id="cb117-69"><a href="#cb117-69" aria-hidden="true" tabindex="-1"></a><span class="st">        alpha_time[ time_stage[i] ] +</span></span>
<span id="cb117-70"><a href="#cb117-70" aria-hidden="true" tabindex="-1"></a><span class="st">        alpha_gender * gender[i] +</span></span>
<span id="cb117-71"><a href="#cb117-71" aria-hidden="true" tabindex="-1"></a><span class="st">        alpha_tr     * transport[i] +   # allow EMS to shift age mix</span></span>
<span id="cb117-72"><a href="#cb117-72" aria-hidden="true" tabindex="-1"></a><span class="st">        alpha_not    * notify[i] +      # allow notification to shift age mix</span></span>
<span id="cb117-73"><a href="#cb117-73" aria-hidden="true" tabindex="-1"></a><span class="st">        u_site_age[ site[i] ]           # site random effect</span></span>
<span id="cb117-74"><a href="#cb117-74" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-75"><a href="#cb117-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-76"><a href="#cb117-76" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha0       ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-77"><a href="#cb117-77" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha_gender ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-78"><a href="#cb117-78" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha_tr     ~ dnorm(0, 1.0E-4)      </span></span>
<span id="cb117-79"><a href="#cb117-79" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha_not    ~ dnorm(0, 1.0E-4)     </span></span>
<span id="cb117-80"><a href="#cb117-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-81"><a href="#cb117-81" aria-hidden="true" tabindex="-1"></a><span class="st">  for (t in 1:nTimeStage) {</span></span>
<span id="cb117-82"><a href="#cb117-82" aria-hidden="true" tabindex="-1"></a><span class="st">    alpha_time[t] ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-83"><a href="#cb117-83" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-84"><a href="#cb117-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-85"><a href="#cb117-85" aria-hidden="true" tabindex="-1"></a><span class="st">  for (s in 1:nSite) {</span></span>
<span id="cb117-86"><a href="#cb117-86" aria-hidden="true" tabindex="-1"></a><span class="st">    u_site_age[s] ~ dnorm(0, tau_site_age)</span></span>
<span id="cb117-87"><a href="#cb117-87" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-88"><a href="#cb117-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-89"><a href="#cb117-89" aria-hidden="true" tabindex="-1"></a><span class="st">  tau_age        &lt;- pow(sigma_age, -2)</span></span>
<span id="cb117-90"><a href="#cb117-90" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_age      ~ dunif(0, 50)      # age in years</span></span>
<span id="cb117-91"><a href="#cb117-91" aria-hidden="true" tabindex="-1"></a><span class="st">  tau_site_age   &lt;- pow(sigma_site_age, -2)</span></span>
<span id="cb117-92"><a href="#cb117-92" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_site_age ~ dunif(0, 20)</span></span>
<span id="cb117-93"><a href="#cb117-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-94"><a href="#cb117-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-95"><a href="#cb117-95" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-96"><a href="#cb117-96" aria-hidden="true" tabindex="-1"></a><span class="st">  # 2. NOTIFY MODEL: notify | transport, site, time, gender</span></span>
<span id="cb117-97"><a href="#cb117-97" aria-hidden="true" tabindex="-1"></a><span class="st">  #    (p(notify | transport, z))</span></span>
<span id="cb117-98"><a href="#cb117-98" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-99"><a href="#cb117-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-100"><a href="#cb117-100" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb117-101"><a href="#cb117-101" aria-hidden="true" tabindex="-1"></a><span class="st">    # notify is only meaningful if transport == 1 (EMS).</span></span>
<span id="cb117-102"><a href="#cb117-102" aria-hidden="true" tabindex="-1"></a><span class="st">    # If transport[i] = 0, then pi_not[i] ≈ 0, so notify[i] ≈ 0.</span></span>
<span id="cb117-103"><a href="#cb117-103" aria-hidden="true" tabindex="-1"></a><span class="st">    notify[i] ~ dbern(pi_not[i])</span></span>
<span id="cb117-104"><a href="#cb117-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-105"><a href="#cb117-105" aria-hidden="true" tabindex="-1"></a><span class="st">    pi_not[i] &lt;- transport[i] * pi_ems[i] + (1 - transport[i]) * 1.0E-6</span></span>
<span id="cb117-106"><a href="#cb117-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-107"><a href="#cb117-107" aria-hidden="true" tabindex="-1"></a><span class="st">    logit(pi_ems[i]) &lt;-</span></span>
<span id="cb117-108"><a href="#cb117-108" aria-hidden="true" tabindex="-1"></a><span class="st">        delta0 +</span></span>
<span id="cb117-109"><a href="#cb117-109" aria-hidden="true" tabindex="-1"></a><span class="st">        delta_time[ time_stage[i] ] +</span></span>
<span id="cb117-110"><a href="#cb117-110" aria-hidden="true" tabindex="-1"></a><span class="st">        delta_gender * gender[i] +</span></span>
<span id="cb117-111"><a href="#cb117-111" aria-hidden="true" tabindex="-1"></a><span class="st">        u_site_not[ site[i] ]</span></span>
<span id="cb117-112"><a href="#cb117-112" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-113"><a href="#cb117-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-114"><a href="#cb117-114" aria-hidden="true" tabindex="-1"></a><span class="st">  delta0        ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-115"><a href="#cb117-115" aria-hidden="true" tabindex="-1"></a><span class="st">  delta_gender  ~ dnorm(0, 1.0E-4)    </span></span>
<span id="cb117-116"><a href="#cb117-116" aria-hidden="true" tabindex="-1"></a><span class="st">  for (t in 1:nTimeStage) {</span></span>
<span id="cb117-117"><a href="#cb117-117" aria-hidden="true" tabindex="-1"></a><span class="st">    delta_time[t] ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-118"><a href="#cb117-118" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-119"><a href="#cb117-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-120"><a href="#cb117-120" aria-hidden="true" tabindex="-1"></a><span class="st">  for (s in 1:nSite) {</span></span>
<span id="cb117-121"><a href="#cb117-121" aria-hidden="true" tabindex="-1"></a><span class="st">    u_site_not[s] ~ dnorm(0, tau_site_not)</span></span>
<span id="cb117-122"><a href="#cb117-122" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-123"><a href="#cb117-123" aria-hidden="true" tabindex="-1"></a><span class="st">  tau_site_not &lt;- pow(sigma_site_not, -2)</span></span>
<span id="cb117-124"><a href="#cb117-124" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_site_not ~ dunif(0, 2)</span></span>
<span id="cb117-125"><a href="#cb117-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-126"><a href="#cb117-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-127"><a href="#cb117-127" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-128"><a href="#cb117-128" aria-hidden="true" tabindex="-1"></a><span class="st">  # 3. TRANSPORT MODEL: transport | site, time, gender</span></span>
<span id="cb117-129"><a href="#cb117-129" aria-hidden="true" tabindex="-1"></a><span class="st">  #    (p(transport | z))</span></span>
<span id="cb117-130"><a href="#cb117-130" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-131"><a href="#cb117-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-132"><a href="#cb117-132" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb117-133"><a href="#cb117-133" aria-hidden="true" tabindex="-1"></a><span class="st">    transport[i] ~ dbern(pi_tr[i])</span></span>
<span id="cb117-134"><a href="#cb117-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-135"><a href="#cb117-135" aria-hidden="true" tabindex="-1"></a><span class="st">    logit(pi_tr[i]) &lt;-</span></span>
<span id="cb117-136"><a href="#cb117-136" aria-hidden="true" tabindex="-1"></a><span class="st">        gamma0 +</span></span>
<span id="cb117-137"><a href="#cb117-137" aria-hidden="true" tabindex="-1"></a><span class="st">        gamma_time[ time_stage[i] ] +</span></span>
<span id="cb117-138"><a href="#cb117-138" aria-hidden="true" tabindex="-1"></a><span class="st">        gamma_gender * gender[i] +</span></span>
<span id="cb117-139"><a href="#cb117-139" aria-hidden="true" tabindex="-1"></a><span class="st">        u_site_tr[ site[i] ]</span></span>
<span id="cb117-140"><a href="#cb117-140" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-141"><a href="#cb117-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-142"><a href="#cb117-142" aria-hidden="true" tabindex="-1"></a><span class="st">  gamma0        ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-143"><a href="#cb117-143" aria-hidden="true" tabindex="-1"></a><span class="st">  gamma_gender  ~ dnorm(0, 1.0E-4)     </span></span>
<span id="cb117-144"><a href="#cb117-144" aria-hidden="true" tabindex="-1"></a><span class="st">  for (t in 1:nTimeStage) {</span></span>
<span id="cb117-145"><a href="#cb117-145" aria-hidden="true" tabindex="-1"></a><span class="st">    gamma_time[t] ~ dnorm(0, 1.0E-4)</span></span>
<span id="cb117-146"><a href="#cb117-146" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-147"><a href="#cb117-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-148"><a href="#cb117-148" aria-hidden="true" tabindex="-1"></a><span class="st">  for (s in 1:nSite) {</span></span>
<span id="cb117-149"><a href="#cb117-149" aria-hidden="true" tabindex="-1"></a><span class="st">    u_site_tr[s] ~ dnorm(0, tau_site_tr)</span></span>
<span id="cb117-150"><a href="#cb117-150" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-151"><a href="#cb117-151" aria-hidden="true" tabindex="-1"></a><span class="st">  tau_site_tr &lt;- pow(sigma_site_tr, -2)</span></span>
<span id="cb117-152"><a href="#cb117-152" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_site_tr ~ dunif(0, 2)</span></span>
<span id="cb117-153"><a href="#cb117-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-154"><a href="#cb117-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-155"><a href="#cb117-155" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-156"><a href="#cb117-156" aria-hidden="true" tabindex="-1"></a><span class="st">  # 4. RACE MODEL: race | site (LAST in ordering)</span></span>
<span id="cb117-157"><a href="#cb117-157" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-158"><a href="#cb117-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-159"><a href="#cb117-159" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:N) {</span></span>
<span id="cb117-160"><a href="#cb117-160" aria-hidden="true" tabindex="-1"></a><span class="st">    race[i] ~ dcat(pi_race[ site[i], 1:nRace ])</span></span>
<span id="cb117-161"><a href="#cb117-161" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-162"><a href="#cb117-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-163"><a href="#cb117-163" aria-hidden="true" tabindex="-1"></a><span class="st">  for (s in 1:nSite) {</span></span>
<span id="cb117-164"><a href="#cb117-164" aria-hidden="true" tabindex="-1"></a><span class="st">    pi_race[s, 1:nRace] ~ ddirch(alpha[])</span></span>
<span id="cb117-165"><a href="#cb117-165" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb117-166"><a href="#cb117-166" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb117-167"><a href="#cb117-167" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-168"><a href="#cb117-168" aria-hidden="true" tabindex="-1"></a><span class="st">  # 5. DERIVED QUANTITIES: baseline vs final stages</span></span>
<span id="cb117-169"><a href="#cb117-169" aria-hidden="true" tabindex="-1"></a><span class="st">  ################################################</span></span>
<span id="cb117-170"><a href="#cb117-170" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_time_baseline &lt;- beta_time[ baseline_stage ]</span></span>
<span id="cb117-171"><a href="#cb117-171" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_time_final    &lt;- beta_time[ final_stage ]</span></span>
<span id="cb117-172"><a href="#cb117-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-173"><a href="#cb117-173" aria-hidden="true" tabindex="-1"></a><span class="st">  # Overall program effect on log-odds and OR</span></span>
<span id="cb117-174"><a href="#cb117-174" aria-hidden="true" tabindex="-1"></a><span class="st">  time_effect &lt;- beta_time_final - beta_time_baseline</span></span>
<span id="cb117-175"><a href="#cb117-175" aria-hidden="true" tabindex="-1"></a><span class="st">  OR_time     &lt;- exp(time_effect)</span></span>
<span id="cb117-176"><a href="#cb117-176" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb117-177"><a href="#cb117-177" aria-hidden="true" tabindex="-1"></a><span class="st">  # Reference patient settings:</span></span>
<span id="cb117-178"><a href="#cb117-178" aria-hidden="true" tabindex="-1"></a><span class="st">  # age_ref = 70, gender = 0, race = reference (nRace),</span></span>
<span id="cb117-179"><a href="#cb117-179" aria-hidden="true" tabindex="-1"></a><span class="st">  # no EMS, no notify, no TPA/thrombectomy/complications,</span></span>
<span id="cb117-180"><a href="#cb117-180" aria-hidden="true" tabindex="-1"></a><span class="st">  # and average site random effect (0).</span></span>
<span id="cb117-181"><a href="#cb117-181" aria-hidden="true" tabindex="-1"></a><span class="st">  age_ref &lt;- 70</span></span>
<span id="cb117-182"><a href="#cb117-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-183"><a href="#cb117-183" aria-hidden="true" tabindex="-1"></a><span class="st">  logit_p_baseline &lt;-</span></span>
<span id="cb117-184"><a href="#cb117-184" aria-hidden="true" tabindex="-1"></a><span class="st">      beta0 +</span></span>
<span id="cb117-185"><a href="#cb117-185" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_age * age_ref +</span></span>
<span id="cb117-186"><a href="#cb117-186" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_gender * 0 +</span></span>
<span id="cb117-187"><a href="#cb117-187" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_ems * 0 +</span></span>
<span id="cb117-188"><a href="#cb117-188" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_not * 0 +</span></span>
<span id="cb117-189"><a href="#cb117-189" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_tpa * 0 +</span></span>
<span id="cb117-190"><a href="#cb117-190" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_thr * 0 +</span></span>
<span id="cb117-191"><a href="#cb117-191" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_tpaC * 0 +</span></span>
<span id="cb117-192"><a href="#cb117-192" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_thrC * 0 +</span></span>
<span id="cb117-193"><a href="#cb117-193" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_time_baseline +</span></span>
<span id="cb117-194"><a href="#cb117-194" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_race[nRace] +   # = 0</span></span>
<span id="cb117-195"><a href="#cb117-195" aria-hidden="true" tabindex="-1"></a><span class="st">      0                    # average u_site_out</span></span>
<span id="cb117-196"><a href="#cb117-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-197"><a href="#cb117-197" aria-hidden="true" tabindex="-1"></a><span class="st">  logit_p_final &lt;-</span></span>
<span id="cb117-198"><a href="#cb117-198" aria-hidden="true" tabindex="-1"></a><span class="st">      beta0 +</span></span>
<span id="cb117-199"><a href="#cb117-199" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_age * age_ref +</span></span>
<span id="cb117-200"><a href="#cb117-200" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_gender * 0 +</span></span>
<span id="cb117-201"><a href="#cb117-201" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_ems * 0 +</span></span>
<span id="cb117-202"><a href="#cb117-202" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_not * 0 +</span></span>
<span id="cb117-203"><a href="#cb117-203" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_tpa * 0 +</span></span>
<span id="cb117-204"><a href="#cb117-204" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_thr * 0 +</span></span>
<span id="cb117-205"><a href="#cb117-205" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_tpaC * 0 +</span></span>
<span id="cb117-206"><a href="#cb117-206" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_thrC * 0 +</span></span>
<span id="cb117-207"><a href="#cb117-207" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_time_final +</span></span>
<span id="cb117-208"><a href="#cb117-208" aria-hidden="true" tabindex="-1"></a><span class="st">      beta_race[nRace] +</span></span>
<span id="cb117-209"><a href="#cb117-209" aria-hidden="true" tabindex="-1"></a><span class="st">      0</span></span>
<span id="cb117-210"><a href="#cb117-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-211"><a href="#cb117-211" aria-hidden="true" tabindex="-1"></a><span class="st">  p_baseline &lt;- exp(logit_p_baseline) / (1 + exp(logit_p_baseline))</span></span>
<span id="cb117-212"><a href="#cb117-212" aria-hidden="true" tabindex="-1"></a><span class="st">  p_final    &lt;- exp(logit_p_final)    / (1 + exp(logit_p_final))</span></span>
<span id="cb117-213"><a href="#cb117-213" aria-hidden="true" tabindex="-1"></a><span class="st">  improvement &lt;- p_final - p_baseline</span></span>
<span id="cb117-214"><a href="#cb117-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-215"><a href="#cb117-215" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb117-216"><a href="#cb117-216" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>baseline_stage <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">levels</span>(x<span class="sc">$</span>time_stage) <span class="sc">==</span> <span class="st">"baseline"</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>final_stage    <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">levels</span>(x<span class="sc">$</span>time_stage) <span class="sc">==</span> <span class="st">"final"</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">N      =</span> <span class="fu">nrow</span>(x),</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nSite  =</span> <span class="fu">nlevels</span>(x<span class="sc">$</span>site_id),</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nTimeStage =</span> <span class="fu">nlevels</span>(x<span class="sc">$</span>time_stage),</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nRace  =</span> <span class="fu">nlevels</span>(x<span class="sc">$</span>race2),</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">home      =</span> x<span class="sc">$</span>home_num,                          <span class="co"># 0/1</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">age       =</span> x<span class="sc">$</span>age,                               <span class="co"># numeric, NA allowed</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">notify    =</span> x<span class="sc">$</span>notify_num,                        <span class="co"># 0/1, NA allowed</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">transport =</span> x<span class="sc">$</span>transport_num,                     <span class="co"># 0/1, NA allowed</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">had_tpa   =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>had_tpa),</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">had_thromb=</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>had_thrombectomy),</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">tpa_comp  =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>tpa_complic),</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">thr_comp  =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>thr_complic),</span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">gender =</span> x<span class="sc">$</span>gender_num,                           <span class="co"># 0/1</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">race   =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>race2),                    <span class="co"># 1..nRace, NA allowed</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">site   =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>site_id),                  <span class="co"># 1..nSite</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_stage =</span> <span class="fu">as.integer</span>(x<span class="sc">$</span>time_stage),           <span class="co"># 1..nTimeStage</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha  =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, <span class="fu">nlevels</span>(x<span class="sc">$</span>race2)),              <span class="co"># Jeffreys prior for race</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_stage =</span> baseline_stage,</span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">final_stage    =</span> final_stage</span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: coda</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'coda'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:arm':

    traceplot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linked to JAGS 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded modules: basemod,bugs</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>results_dir <span class="ot">&lt;-</span> <span class="st">"results"</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>samples_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(results_dir, <span class="st">"posterior_samples_jags.rds"</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>summary_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(results_dir, <span class="st">"posterior_summary.rds"</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>stats_path   <span class="ot">&lt;-</span> <span class="fu">file.path</span>(results_dir, <span class="st">"posterior_statistics.csv"</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(results_dir)) {</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(results_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(samples_path) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(summary_path)) {</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>  posterior_samples <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(samples_path)</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>  posterior_summary <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(summary_path)</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>  jmod <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">textConnection</span>(model_string),</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_list,</span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.chains =</span> <span class="dv">3</span></span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(jmod, <span class="dv">2000</span>)</span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>  params_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb125-23"><a href="#cb125-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"beta0"</span>, <span class="st">"beta_age"</span>, <span class="st">"beta_gender"</span>, <span class="st">"beta_ems"</span>, <span class="st">"beta_not"</span>,</span>
<span id="cb125-24"><a href="#cb125-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"beta_tpa"</span>, <span class="st">"beta_thr"</span>, <span class="st">"beta_tpaC"</span>, <span class="st">"beta_thrC"</span>,</span>
<span id="cb125-25"><a href="#cb125-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"beta_time"</span>, <span class="st">"beta_race"</span>,</span>
<span id="cb125-26"><a href="#cb125-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sigma_site_out"</span>, <span class="st">"sigma_age"</span>, <span class="st">"sigma_site_age"</span>,</span>
<span id="cb125-27"><a href="#cb125-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sigma_site_not"</span>, <span class="st">"sigma_site_tr"</span></span>
<span id="cb125-28"><a href="#cb125-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-29"><a href="#cb125-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-30"><a href="#cb125-30" aria-hidden="true" tabindex="-1"></a>  posterior_samples <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(</span>
<span id="cb125-31"><a href="#cb125-31" aria-hidden="true" tabindex="-1"></a>    jmod,</span>
<span id="cb125-32"><a href="#cb125-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable.names =</span> params_of_interest,</span>
<span id="cb125-33"><a href="#cb125-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.iter =</span> <span class="dv">8000</span></span>
<span id="cb125-34"><a href="#cb125-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-35"><a href="#cb125-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-36"><a href="#cb125-36" aria-hidden="true" tabindex="-1"></a>  posterior_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(posterior_samples)</span>
<span id="cb125-37"><a href="#cb125-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-38"><a href="#cb125-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(posterior_samples, samples_path)</span>
<span id="cb125-39"><a href="#cb125-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(posterior_summary, summary_path)</span>
<span id="cb125-40"><a href="#cb125-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(</span>
<span id="cb125-41"><a href="#cb125-41" aria-hidden="true" tabindex="-1"></a>    posterior_summary<span class="sc">$</span>statistics,</span>
<span id="cb125-42"><a href="#cb125-42" aria-hidden="true" tabindex="-1"></a>    stats_path,</span>
<span id="cb125-43"><a href="#cb125-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">TRUE</span></span>
<span id="cb125-44"><a href="#cb125-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-45"><a href="#cb125-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb125-46"><a href="#cb125-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-47"><a href="#cb125-47" aria-hidden="true" tabindex="-1"></a>posterior_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 3001:11000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 8000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

                   Mean       SD  Naive SE Time-series SE
beta0           6.52405 0.595041 3.841e-03      0.0590078
beta_age       -0.06355 0.006586 4.251e-05      0.0005395
beta_ems       -1.03885 0.331287 2.138e-03      0.0176562
beta_gender    -0.39185 0.130977 8.455e-04      0.0020042
beta_not       -0.02121 0.214087 1.382e-03      0.0068704
beta_race[1]    0.00000 0.000000 0.000e+00      0.0000000
beta_race[2]   -0.40698 0.154776 9.991e-04      0.0023486
beta_race[3]   -0.37773 0.289808 1.871e-03      0.0036239
beta_thr       -0.55167 0.164571 1.062e-03      0.0045981
beta_thrC      -1.49977 0.413839 2.671e-03      0.0040390
beta_time[1]    0.00000 0.000000 0.000e+00      0.0000000
beta_time[2]    0.18724 0.164129 1.059e-03      0.0034822
beta_time[3]    0.27450 0.190961 1.233e-03      0.0038448
beta_tpa        0.59879 0.170700 1.102e-03      0.0048564
beta_tpaC      -1.42800 0.394275 2.545e-03      0.0044394
sigma_age      14.41652 0.335241 2.164e-03      0.0047385
sigma_site_age  2.55989 1.095630 7.072e-03      0.0234976
sigma_site_not  1.43867 0.307848 1.987e-03      0.0042096
sigma_site_out  0.18966 0.120451 7.775e-04      0.0034977
sigma_site_tr   0.42839 0.186333 1.203e-03      0.0036825

2. Quantiles for each variable:

                   2.5%      25%      50%      75%   97.5%
beta0           5.45150  6.09692  6.51143  6.91828  7.7349
beta_age       -0.07745 -0.06775 -0.06345 -0.05883 -0.0516
beta_ems       -1.71980 -1.25242 -1.02919 -0.81216 -0.4214
beta_gender    -0.64912 -0.48006 -0.39164 -0.30395 -0.1386
beta_not       -0.44820 -0.16515 -0.01985  0.12276  0.3919
beta_race[1]    0.00000  0.00000  0.00000  0.00000  0.0000
beta_race[2]   -0.71111 -0.51198 -0.40613 -0.30359 -0.1045
beta_race[3]   -0.94215 -0.57399 -0.38149 -0.18515  0.1889
beta_thr       -0.87476 -0.66272 -0.55177 -0.44145 -0.2270
beta_thrC      -2.33010 -1.77012 -1.49359 -1.21683 -0.7087
beta_time[1]    0.00000  0.00000  0.00000  0.00000  0.0000
beta_time[2]   -0.13692  0.07709  0.18900  0.29675  0.5117
beta_time[3]   -0.10026  0.14650  0.27477  0.40208  0.6517
beta_tpa        0.27158  0.48266  0.59731  0.71498  0.9366
beta_tpaC      -2.21082 -1.69371 -1.42897 -1.16099 -0.6594
sigma_age      13.77888 14.18419 14.40891 14.63896 15.0960
sigma_site_age  1.07283  1.81095  2.35488  3.07039  5.2368
sigma_site_not  0.85174  1.20498  1.44190  1.68724  1.9612
sigma_site_out  0.01756  0.10506  0.17277  0.25067  0.4755
sigma_site_tr   0.15336  0.30060  0.39902  0.52195  0.8739</code></pre>
</div>
</div>
</section>
<section id="trace-plots" class="level1">
<h1>Trace plots</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>old_par <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posterior_samples[, <span class="fu">c</span>(<span class="st">"beta0"</span>, <span class="st">"beta_age"</span>, <span class="st">"beta_tpa"</span>, <span class="st">"beta_thr"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="code_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(old_par)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Need to look into the mixing for beta0 and beta_age.</p>
</section>
<section id="gelman-rubin-diagnostic" class="level1">
<h1>Gelman-Rubin Diagnostic</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>gelman_diag <span class="ot">&lt;-</span> <span class="fu">gelman.diag</span>(posterior_samples, <span class="at">multivariate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>gelman_diag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

               Point est. Upper C.I.
beta0                1.06       1.17
beta_age             1.06       1.19
beta_ems             1.01       1.02
beta_gender          1.00       1.00
beta_not             1.01       1.04
beta_race[1]          NaN        NaN
beta_race[2]         1.00       1.01
beta_race[3]         1.00       1.00
beta_thr             1.01       1.02
beta_thrC            1.00       1.00
beta_time[1]          NaN        NaN
beta_time[2]         1.00       1.01
beta_time[3]         1.00       1.01
beta_tpa             1.00       1.00
beta_tpaC            1.00       1.00
sigma_age            1.00       1.00
sigma_site_age       1.00       1.01
sigma_site_not       1.00       1.01
sigma_site_out       1.01       1.01
sigma_site_tr        1.00       1.01</code></pre>
</div>
</div>
<p>Most potential scale-reduction factors are near 1, so indicates that the three chains mixed well.</p>
</section>
<section id="effective-size-results" class="level1">
<h1>Effective Size Results</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>ess_values <span class="ot">&lt;-</span> <span class="fu">effectiveSize</span>(posterior_samples)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>ess_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         beta0       beta_age       beta_ems    beta_gender       beta_not 
      106.3609       152.6666       350.9438      4272.0414       962.3331 
  beta_race[1]   beta_race[2]   beta_race[3]       beta_thr      beta_thrC 
        0.0000      4487.2415      6520.6005      1336.4403     10551.4197 
  beta_time[1]   beta_time[2]   beta_time[3]       beta_tpa      beta_tpaC 
        0.0000      2254.6390      2484.7924      1245.2473      8009.2716 
     sigma_age sigma_site_age sigma_site_not sigma_site_out  sigma_site_tr 
     5031.5575      2253.9225      5681.3536      1178.8628      2582.6084 </code></pre>
</div>
</div>
</section>
<section id="posterior-results" class="level1">
<h1>Posterior Results</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>posterior_stats <span class="ot">&lt;-</span> posterior_summary<span class="sc">$</span>statistics <span class="sc">%&gt;%</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>posterior_quants <span class="ot">&lt;-</span> posterior_summary<span class="sc">$</span>quantiles <span class="sc">%&gt;%</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"parameter"</span>)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>posterior_table <span class="ot">&lt;-</span> posterior_stats <span class="sc">%&gt;%</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(parameter, Mean, SD) <span class="sc">%&gt;%</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>    posterior_quants <span class="sc">%&gt;%</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(parameter, <span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>, <span class="st">`</span><span class="at">50%</span><span class="st">`</span>, <span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>),</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"parameter"</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_detect</span>(</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>      parameter,</span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^(beta_(age|tpa|thr|ems|not|time|race)|sigma_site_out)"</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>posterior_table <span class="sc">%&gt;%</span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Posterior means and 95% credible intervals."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Posterior means and 95% credible intervals.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">SD</th>
<th style="text-align: right;">2.5%</th>
<th style="text-align: right;">50%</th>
<th style="text-align: right;">97.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta_age</td>
<td style="text-align: right;">-0.064</td>
<td style="text-align: right;">0.007</td>
<td style="text-align: right;">-0.077</td>
<td style="text-align: right;">-0.063</td>
<td style="text-align: right;">-0.052</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_ems</td>
<td style="text-align: right;">-1.039</td>
<td style="text-align: right;">0.331</td>
<td style="text-align: right;">-1.720</td>
<td style="text-align: right;">-1.029</td>
<td style="text-align: right;">-0.421</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_not</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">0.214</td>
<td style="text-align: right;">-0.448</td>
<td style="text-align: right;">-0.020</td>
<td style="text-align: right;">0.392</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_race[1]</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_race[2]</td>
<td style="text-align: right;">-0.407</td>
<td style="text-align: right;">0.155</td>
<td style="text-align: right;">-0.711</td>
<td style="text-align: right;">-0.406</td>
<td style="text-align: right;">-0.104</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_race[3]</td>
<td style="text-align: right;">-0.378</td>
<td style="text-align: right;">0.290</td>
<td style="text-align: right;">-0.942</td>
<td style="text-align: right;">-0.381</td>
<td style="text-align: right;">0.189</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_thr</td>
<td style="text-align: right;">-0.552</td>
<td style="text-align: right;">0.165</td>
<td style="text-align: right;">-0.875</td>
<td style="text-align: right;">-0.552</td>
<td style="text-align: right;">-0.227</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_thrC</td>
<td style="text-align: right;">-1.500</td>
<td style="text-align: right;">0.414</td>
<td style="text-align: right;">-2.330</td>
<td style="text-align: right;">-1.494</td>
<td style="text-align: right;">-0.709</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_time[1]</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_time[2]</td>
<td style="text-align: right;">0.187</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: right;">-0.137</td>
<td style="text-align: right;">0.189</td>
<td style="text-align: right;">0.512</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_time[3]</td>
<td style="text-align: right;">0.274</td>
<td style="text-align: right;">0.191</td>
<td style="text-align: right;">-0.100</td>
<td style="text-align: right;">0.275</td>
<td style="text-align: right;">0.652</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_tpa</td>
<td style="text-align: right;">0.599</td>
<td style="text-align: right;">0.171</td>
<td style="text-align: right;">0.272</td>
<td style="text-align: right;">0.597</td>
<td style="text-align: right;">0.937</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_tpaC</td>
<td style="text-align: right;">-1.428</td>
<td style="text-align: right;">0.394</td>
<td style="text-align: right;">-2.211</td>
<td style="text-align: right;">-1.429</td>
<td style="text-align: right;">-0.659</td>
</tr>
<tr class="even">
<td style="text-align: left;">sigma_site_out</td>
<td style="text-align: right;">0.190</td>
<td style="text-align: right;">0.120</td>
<td style="text-align: right;">0.018</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">0.476</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>posterior_table <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(parameter, <span class="st">"^beta"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR_mean =</span> <span class="fu">exp</span>(Mean),</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR_low  =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">2.5%</span><span class="st">`</span>),</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">OR_high =</span> <span class="fu">exp</span>(<span class="st">`</span><span class="at">97.5%</span><span class="st">`</span>)</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(parameter, OR_mean, OR_low, OR_high) <span class="sc">%&gt;%</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Posterior odds ratios for key covariates."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Posterior odds ratios for key covariates.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">parameter</th>
<th style="text-align: right;">OR_mean</th>
<th style="text-align: right;">OR_low</th>
<th style="text-align: right;">OR_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta_age</td>
<td style="text-align: right;">0.938</td>
<td style="text-align: right;">0.925</td>
<td style="text-align: right;">0.950</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_ems</td>
<td style="text-align: right;">0.354</td>
<td style="text-align: right;">0.179</td>
<td style="text-align: right;">0.656</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_not</td>
<td style="text-align: right;">0.979</td>
<td style="text-align: right;">0.639</td>
<td style="text-align: right;">1.480</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_race[1]</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_race[2]</td>
<td style="text-align: right;">0.666</td>
<td style="text-align: right;">0.491</td>
<td style="text-align: right;">0.901</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_race[3]</td>
<td style="text-align: right;">0.685</td>
<td style="text-align: right;">0.390</td>
<td style="text-align: right;">1.208</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_thr</td>
<td style="text-align: right;">0.576</td>
<td style="text-align: right;">0.417</td>
<td style="text-align: right;">0.797</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_thrC</td>
<td style="text-align: right;">0.223</td>
<td style="text-align: right;">0.097</td>
<td style="text-align: right;">0.492</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_time[1]</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">1.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_time[2]</td>
<td style="text-align: right;">1.206</td>
<td style="text-align: right;">0.872</td>
<td style="text-align: right;">1.668</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_time[3]</td>
<td style="text-align: right;">1.316</td>
<td style="text-align: right;">0.905</td>
<td style="text-align: right;">1.919</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta_tpa</td>
<td style="text-align: right;">1.820</td>
<td style="text-align: right;">1.312</td>
<td style="text-align: right;">2.551</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta_tpaC</td>
<td style="text-align: right;">0.240</td>
<td style="text-align: right;">0.110</td>
<td style="text-align: right;">0.517</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="residual-plots" class="level1">
<h1>Residual Plots</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>